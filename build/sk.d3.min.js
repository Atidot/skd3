/* skd3 version 0.1.0 (https://github.com/fabriciorhs/skd3) 2017-09-03 */

!function(){var a={};a.alertVersion=function(){alert(this.version)},"undefined"!=typeof module&&"undefined"!=typeof exports&&"undefined"==typeof d3&&(d3=require("d3")),"undefined"!=typeof module&&"undefined"!=typeof exports&&(module.exports=a),"undefined"!=typeof window&&(window.sk=a),function(a,b){"object"==typeof exports&&"undefined"!=typeof module?b(exports,require("d3-array"),require("d3-collection"),require("d3-shape")):"function"==typeof define&&define.amd?define(["exports","d3-array","d3-collection","d3-shape"],b):b(a.d3=a.d3||{},a.d3,a.d3,a.d3)}(this,function(a,b,c,d){"use strict";function e(a){return function(){return a}}function f(a,b){return a.source.y-b.source.y}function g(a,b){return a.target.y-b.target.y}function h(a,b){return a.y-b.y}function i(a){return a.value}function j(a){return a.y+a.dy/2}function k(a){return j(a.source)*a.value}function l(a){return j(a.target)*a.value}function m(a){return a.nodes}function n(a){return a.links}function o(a){return[a.source.x+a.source.dx,a.source.y+a.sy+a.dy/2]}function p(a){return[a.target.x,a.target.y+a.ty+a.dy/2]}var q=function(){function a(){var a={nodes:A.apply(null,arguments),links:B.apply(null,arguments)};return d(a),o(a),p(a),s(a),t(a),a}function d(a){a.nodes.forEach(function(a){a.sourceLinks=[],a.targetLinks=[]}),a.links.forEach(function(b){var c=b.source,d=b.target;"number"==typeof c&&(c=b.source=a.nodes[b.source]),"number"==typeof d&&(d=b.target=a.nodes[b.target]),c.sourceLinks.push(b),d.targetLinks.push(b)})}function o(a){a.nodes.forEach(function(a){a.value=Math.max(b.sum(a.sourceLinks,i),b.sum(a.targetLinks,i))})}function p(a){for(var b,c=a.nodes,d=0;c.length;)b=[],c.forEach(function(a){a.x=d,a.dx=y,a.sourceLinks.forEach(function(a){b.indexOf(a.target)<0&&b.push(a.target)})}),c=b,++d;q(a,d),r(a,(w-u-y)/(d-1))}function q(a,b){a.nodes.forEach(function(a){a.sourceLinks.length||(a.x=b-1)})}function r(a,b){a.nodes.forEach(function(a){a.x=u+a.x*b})}function s(a){function d(){e.forEach(function(a){var b,c,d,e=v,f=a.length;for(a.sort(h),d=0;d<f;++d)b=a[d],c=e-b.y,c>0&&(b.y+=c),e=b.y+b.dy+z;if((c=e-z-x)>0)for(e=b.y-=c,d=f-2;d>=0;--d)b=a[d],c=b.y+b.dy+z-e,c>0&&(b.y-=c),e=b.y})}var e=c.nest().key(function(a){return a.x}).sortKeys(b.ascending).entries(a.nodes).map(function(a){return a.values});!function(){var c=b.min(e,function(a){return(x-v-(a.length-1)*z)/b.sum(a,i)});e.forEach(function(a){a.forEach(function(a,b){a.y=b,a.dy=a.value*c})}),a.links.forEach(function(a){a.dy=a.value*c})}(),d();for(var f=1,g=C;g>0;--g)!function(a){e.slice().reverse().forEach(function(c){c.forEach(function(c){c.sourceLinks.length&&(c.y+=(b.sum(c.sourceLinks,l)/b.sum(c.sourceLinks,i)-j(c))*a)})})}(f*=.99),d(),function(a){e.forEach(function(c){c.forEach(function(c){c.targetLinks.length&&(c.y+=(b.sum(c.targetLinks,k)/b.sum(c.targetLinks,i)-j(c))*a)})})}(f),d()}function t(a){a.nodes.forEach(function(a){a.sourceLinks.sort(g),a.targetLinks.sort(f)}),a.nodes.forEach(function(a){var b=0,c=0;a.sourceLinks.forEach(function(a){a.sy=b,b+=a.dy}),a.targetLinks.forEach(function(a){a.ty=c,c+=a.dy})})}var u=0,v=0,w=1,x=1,y=24,z=8,A=m,B=n,C=32;return a.update=function(a){return t(a),a},a.nodeWidth=function(b){return arguments.length?(y=+b,a):y},a.nodePadding=function(b){return arguments.length?(z=+b,a):z},a.nodes=function(b){return arguments.length?(A="function"==typeof b?b:e(b),a):A},a.links=function(b){return arguments.length?(B="function"==typeof b?b:e(b),a):B},a.size=function(b){return arguments.length?(u=v=0,w=+b[0],x=+b[1],a):[w-u,x-v]},a.extent=function(b){return arguments.length?(u=+b[0][0],w=+b[1][0],v=+b[0][1],x=+b[1][1],a):[[u,v],[w,x]]},a.iterations=function(b){return arguments.length?(C=+b,a):C},a},r=function(){return d.linkHorizontal().source(o).target(p)};a.sankey=q,a.sankeyLinkHorizontal=r,Object.defineProperty(a,"__esModule",{value:!0})}),function(a,b){if("function"==typeof define&&define.amd)define(["d3-collection","d3-selection"],b);else if("object"==typeof module&&module.exports){var c=require("d3-collection"),d=require("d3-selection");module.exports=b(c,d)}else{var e=a.d3;a.d3.tip=b(e,e)}}(this,function(a,b){return function(){function c(a){(y=p(a))&&(z=y.createSVGPoint(),w.appendChild(x))}function d(){return"n"}function e(){return[0,0]}function f(){return" "}function g(){var a=r();return{top:a.n.y-x.offsetHeight,left:a.n.x-x.offsetWidth/2}}function h(){var a=r();return{top:a.s.y,left:a.s.x-x.offsetWidth/2}}function i(){var a=r();return{top:a.e.y-x.offsetHeight/2,left:a.e.x}}function j(){var a=r();return{top:a.w.y-x.offsetHeight/2,left:a.w.x-x.offsetWidth}}function k(){var a=r();return{top:a.nw.y-x.offsetHeight,left:a.nw.x-x.offsetWidth}}function l(){var a=r();return{top:a.ne.y-x.offsetHeight,left:a.ne.x}}function m(){var a=r();return{top:a.sw.y,left:a.sw.x-x.offsetWidth}}function n(){var a=r();return{top:a.se.y,left:a.se.x}}function o(){var a=b.select(document.createElement("div"));return a.style("position","absolute").style("top",0).style("opacity",0).style("pointer-events","none").style("box-sizing","border-box"),a.node()}function p(a){var b=a.node();return b?"svg"===b.tagName.toLowerCase()?b:b.ownerSVGElement:null}function q(){return null==x&&(x=o(),w.appendChild(x)),b.select(x)}function r(){for(var a=A||b.event.target;null==a.getScreenCTM&&null==a.parentNode;)a=a.parentNode;var c={},d=a.getScreenCTM(),e=a.getBBox(),f=e.width,g=e.height,h=e.x,i=e.y;return z.x=h,z.y=i,c.nw=z.matrixTransform(d),z.x+=f,c.ne=z.matrixTransform(d),z.y+=g,c.se=z.matrixTransform(d),z.x-=f,c.sw=z.matrixTransform(d),z.y-=g/2,c.w=z.matrixTransform(d),z.x+=f,c.e=z.matrixTransform(d),z.x-=f/2,z.y-=g/2,c.n=z.matrixTransform(d),z.y+=g,c.s=z.matrixTransform(d),c}function s(a){return"function"==typeof a?a:function(){return a}}var t=d,u=e,v=f,w=document.body,x=o(),y=null,z=null,A=null;c.show=function(){var a=Array.prototype.slice.call(arguments);a[a.length-1]instanceof SVGElement&&(A=a.pop());var b,d=v.apply(this,a),e=u.apply(this,a),f=t.apply(this,a),g=q(),h=C.length,i=document.documentElement.scrollTop||w.scrollTop,j=document.documentElement.scrollLeft||w.scrollLeft;for(g.html(d).style("opacity",1).style("pointer-events","all");h--;)g.classed(C[h],!1);return b=B.get(f).apply(this),g.classed(f,!0).style("top",b.top+e[0]+i+"px").style("left",b.left+e[1]+j+"px"),c},c.hide=function(){return q().style("opacity",0).style("pointer-events","none"),c},c.attr=function(a,d){if(arguments.length<2&&"string"==typeof a)return q().attr(a);var e=Array.prototype.slice.call(arguments);return b.selection.prototype.attr.apply(q(),e),c},c.style=function(a,d){if(arguments.length<2&&"string"==typeof a)return q().style(a);var e=Array.prototype.slice.call(arguments);return b.selection.prototype.style.apply(q(),e),c},c.direction=function(a){return arguments.length?(t=null==a?a:s(a),c):t},c.offset=function(a){return arguments.length?(u=null==a?a:s(a),c):u},c.html=function(a){return arguments.length?(v=null==a?a:s(a),c):v},c.rootElement=function(a){return arguments.length?(w=null==a?a:s(a),c):w},c.destroy=function(){return x&&(q().remove(),x=null),c};var B=a.map({n:g,s:h,e:i,w:j,nw:k,ne:l,sw:m,se:n}),C=B.keys();return c}}),a.createSankey=function(a,b,c){function d(a,b){var c=a.node().getBoundingClientRect();return{width:c.width-b.left-b.right,height:c.height-b.top-b.bottom}}function e(a){return b.links.formatValue?b.links.formatValue(a):a+" "+b.links.unit}function f(a){x(),d3.select(this).attr("transform","translate("+a.x+","+(a.y=Math.max(0,Math.min(k.height-a.dy,d3.event.y)))+")"),n.update(h),y.attr("d",o)}var g=function(a){return Math.max(a,Number.MIN_VALUE)},h={nodes:[],links:[]};c.nodes.map(function(a){h.nodes.push({name:a.name,color:a.color,id:a.id})}),c.links.map(function(a){h.links.push({source:a.source,target:a.target,id:a.id,value:g(a.value)})}),function(a){for(var b=0;b<a.length;b++)void 0==a[b].id&&(a[b].id=a[b].source+" -> "+a[b].target)}(h.links),d3.select(".d3-tip-nodes").remove(),d3.select(".d3-tip").remove(),d3.select(a+" svg").remove();var i,j=d3.select(a),k=d(j,b.margin),l=j.append("svg").attr("width",k.width+b.margin.left+b.margin.right).attr("height",k.height+b.margin.top+b.margin.bottom).attr("class","sk-svg"),m=l.append("g").attr("transform","translate("+b.margin.left+","+b.margin.top+")"),n=d3.sankey().nodeWidth(15).nodePadding(10).extent([[0,0],[k.width,k.height]]),o=d3.sankeyLinkHorizontal(),p=function(a){return b.nodes.fontSize},q=function(a){};b.nodes.dynamicSizeFontNode.enabled&&(i=d3.scaleLinear().range([b.nodes.dynamicSizeFontNode.minSize,b.nodes.dynamicSizeFontNode.maxSize]),q=function(a){i.domain(d3.extent(a,function(a){return a.value}))},p=function(a){return Math.floor(i(a.value))});for(var r=0;r<h.nodes.length;r++)void 0==h.nodes[r].color&&(h.nodes[r].color=b.nodes.colors(h.nodes[r].name.replace(/ .*/,"")));var s=65,t=130,u=d3.tip().attr("class","d3-tip").offset([-10,0]),v=d3.tip().attr("class","d3-tip d3-tip-nodes").offset([-10,0]);u.html(function(a){var b,c;return h.links.indexOf(a.source.name)>-1?(c=a.source.name,b=a.target.name):(c=a.target.name,b=a.source.name),'<div class="table-wrapper"><center><h1>'+b+'</h1></center><table><tr><td class="col-left">'+c+'</td><td align="right">'+e(a.value)+"</td></tr></table></div>"});var w=d3.select(".sk-svg").node().getBoundingClientRect().top;u.move=function(a){u.style("top",function(){return d3.event.pageY-w-s>=0?d3.event.pageY-s+"px":d3.event.pageY+20+"px"}).style("left",function(){var a=Math.max(d3.event.pageX-s,10);return(a=Math.min(a,window.innerWidth-d3.select(".d3-tip").node().getBoundingClientRect().width-20))+"px"})},v.html(function(a){var c,d=a.name,f=a.targetLinks,g=a.sourceLinks;for(c='<div class="table-wrapper"><center><h1>'+d+"</h1></center><table>",f.length>0&g.length>0&&(c+="<tr><td><h2>"+b.tooltip.labelSource+"</h2></td><td></td></tr>"),r=0;r<f.length;++r)c+='<tr><td class="col-left">'+f[r].source.name+'</td><td align="right">'+e(f[r].value)+"</td></tr>";for(f.length>0&g.length>0&&(c+="<tr><td></td><td></td><tr><td></td><td></td> </tr><tr><td><h2>"+b.tooltip.labelTarget+"</h2></td><td></td></tr>"),r=0;r<g.length;++r)c+='<tr><td class="col-left">'+g[r].target.name+'</td><td align="right">'+e(g[r].value)+"</td></tr>";return c+="</table></div>"}),v.move=function(a){v.boxInfo=d3.select(".d3-tip-nodes").node().getBoundingClientRect(),v.style("top",function(){return d3.event.pageY-w-v.boxInfo.height-20>=0?d3.event.pageY-v.boxInfo.height-20+"px":d3.event.pageY+20+"px"}).style("left",function(){var a=Math.max(d3.event.pageX-t,10);return(a=Math.min(a,window.innerWidth-d3.select(".d3-tip").node().getBoundingClientRect().width-20))+"px"})},m.call(u),m.call(v);var x=function(){u&&u.hide(),v&&v.hide()};n(h),q(h.nodes);var y=m.append("g").selectAll(".sk-link").data(h.links,function(a){return a.id}).enter().append("path").attr("class","sk-link").attr("d",o).style("stroke",function(a){return a.source.color}).style("stroke-width",function(a){return Math.max(1,a.dy)+"px"}).sort(function(a,b){return b.dy-a.dy});b.tooltip.infoDiv?y.on("mousemove",u.move).on("mouseover",u.show).on("mouseout",u.hide):y.append("title").text(function(a){return a.source.name+" -> "+a.target.name+"\n"+e(a.value)});var z=m.append("g").selectAll(".sk-node").data(h.nodes,function(a){return a.name}).enter().append("g").attr("class","sk-node").attr("transform",function(a){return"translate("+a.x+","+a.y+")"});b.tooltip.infoDiv?z.on("mousemove",v.move).on("mouseover",v.show).on("mouseout",v.hide):z.append("title").text(function(a){return a.name+"\n"+e(a.value)}),b.nodes.canDragNodes&&z.call(d3.drag().subject(function(a){return a}).on("start",function(){d3.event.sourceEvent.stopPropagation(),this.parentNode.appendChild(this)}).on("drag",f)),z.append("rect").attr("height",function(a){return a.dy}).attr("width",n.nodeWidth()).style("fill",function(a){return a.color}).style("stroke",function(a){return d3.rgb(a.color).darker(1.8)}),z.append("text").attr("x",-6).attr("y",function(a){return a.dy/2}).attr("dy",".35em").attr("text-anchor","end").attr("transform",null).style("fill",function(a){return d3.rgb(a.color).darker(2.4)}).text(function(a){return a.name}).style("font-size",function(a){return p(a)+"px"}).filter(function(a){return a.x<k.width/2}).attr("x",6+n.nodeWidth()).attr("text-anchor","start");var A=function(a){x(),n(a),n.update(a),q(a.nodes),m.selectAll(".sk-link").data(a.links,function(a){return a.id}).sort(function(a,b){return b.dy-a.dy}).transition().duration(1300).attr("d",o).style("stroke-width",function(a){return Math.max(1,a.dy)+"px"}),m.selectAll(".sk-node").data(a.nodes,function(a){return a.name}).transition().duration(1300).attr("transform",function(a){return"translate("+a.x+","+a.y+")"}),m.selectAll(".sk-node rect").transition().duration(1300).attr("height",function(a){return a.dy}),m.selectAll(".sk-node text").transition().duration(1300).attr("y",function(a){return a.dy/2}).style("font-size",function(a){return p(a)+"px"})};return this.updateData=function(a){for(var b=0;b<a.links.length;b++){var c=a.links[b].id||a.links[b].source+" -> "+a.links[b].target,d=h.links.filter(function(a){return a.id==c})[0];d&&(d.value=g(a.links[b].value))}A(h)},this},a.version="0.1.0"}();
//# sourceMappingURL=sk.d3.min.js.map
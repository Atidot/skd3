/* skd3 version 0.2.0 (https://github.com/fabriciorhs/skd3) 2018-09-22 */

!function(){var t={};t.alertVersion=function(){alert(this.version)},"undefined"!=typeof module&&"undefined"!=typeof exports&&"undefined"==typeof d3&&(d3=require("d3")),"undefined"!=typeof module&&"undefined"!=typeof exports&&(module.exports=t),"undefined"!=typeof window&&(window.sk=t),function(t,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports,require("d3-array"),require("d3-collection"),require("d3-shape")):"function"==typeof define&&define.amd?define(["exports","d3-array","d3-collection","d3-shape"],n):n(t.d3=t.d3||{},t.d3,t.d3,t.d3)}(this,function(t,n,e,r){"use strict";function o(t){return t.target.depth}function i(t,n){return t.sourceLinks.length?t.depth:n-1}function u(t){return function(){return t}}function a(t,n){return l(t.source,n.source)||t.index-n.index}function s(t,n){return l(t.target,n.target)||t.index-n.index}function l(t,n){return t.y0-n.y0}function d(t){return t.value}function c(t){return(t.y0+t.y1)/2}function f(t){return c(t.source)*t.value}function h(t){return c(t.target)*t.value}function p(t){return t.index}function g(t){return t.nodes}function y(t){return t.links}function m(t,n){var e=t.get(n);if(!e)throw new Error("missing: "+n);return e}function v(t){return[t.source.x1,t.y0]}function k(t){return[t.target.x0,t.y1]}t.sankey=function(){function t(){var t={nodes:z.apply(null,arguments),links:T.apply(null,arguments)};return r(t),o(t),v(t),k(t),x(t),t}function r(t){t.nodes.forEach(function(t,n){t.index=n,t.sourceLinks=[],t.targetLinks=[]});var n=e.map(t.nodes,A);t.links.forEach(function(t,e){t.index=e;var r=t.source,o=t.target;"object"!=typeof r&&(r=t.source=m(n,r)),"object"!=typeof o&&(o=t.target=m(n,o)),r.sourceLinks.push(t),o.targetLinks.push(t)})}function o(t){t.nodes.forEach(function(t){t.value=Math.max(n.sum(t.sourceLinks,d),n.sum(t.targetLinks,d))})}function v(t){var n,e,r;for(n=t.nodes,e=[],r=0;n.length;++r,n=e,e=[])n.forEach(function(t){t.depth=r,t.sourceLinks.forEach(function(t){e.indexOf(t.target)<0&&e.push(t.target)})});for(n=t.nodes,e=[],r=0;n.length;++r,n=e,e=[])n.forEach(function(t){t.height=r,t.targetLinks.forEach(function(t){e.indexOf(t.source)<0&&e.push(t.source)})});var o=(b-w-M)/(r-1);t.nodes.forEach(function(t){t.x1=(t.x0=w+Math.max(0,Math.min(r-1,Math.floor(S.call(null,t,r))))*o)+M})}function k(t){function r(){o.forEach(function(t){var n,e,r,o=L,i=t.length;for(t.sort(l),r=0;r<i;++r)(e=o-(n=t[r]).y0)>0&&(n.y0+=e,n.y1+=e),o=n.y1+C;if((e=o-C-E)>0)for(o=n.y0-=e,n.y1-=e,r=i-2;r>=0;--r)(e=(n=t[r]).y1+C-o)>0&&(n.y0-=e,n.y1-=e),o=n.y0})}var o=e.nest().key(function(t){return t.x0}).sortKeys(n.ascending).entries(t.nodes).map(function(t){return t.values});!function(){var e=n.min(o,function(t){return(E-L-(t.length-1)*C)/n.sum(t,d)});o.forEach(function(t){t.forEach(function(t,n){t.y1=(t.y0=n)+t.value*e})}),t.links.forEach(function(t){t.width=t.value*e})}(),r();for(var i=1,u=W;u>0;--u)!function(t){o.slice().reverse().forEach(function(e){e.forEach(function(e){if(e.sourceLinks.length){var r=(n.sum(e.sourceLinks,h)/n.sum(e.sourceLinks,d)-c(e))*t;e.y0+=r,e.y1+=r}})})}(i*=.99),r(),function(t){o.forEach(function(e){e.forEach(function(e){if(e.targetLinks.length){var r=(n.sum(e.targetLinks,f)/n.sum(e.targetLinks,d)-c(e))*t;e.y0+=r,e.y1+=r}})})}(i),r()}function x(t){t.nodes.forEach(function(t){t.sourceLinks.sort(s),t.targetLinks.sort(a)}),t.nodes.forEach(function(t){var n=t.y0,e=n;t.sourceLinks.forEach(function(t){t.y0=n+t.width/2,n+=t.width}),t.targetLinks.forEach(function(t){t.y1=e+t.width/2,e+=t.width})})}var w=0,L=0,b=1,E=1,M=24,C=8,A=p,S=i,z=g,T=y,W=32;return t.update=function(t){return x(t),t},t.nodeId=function(n){return arguments.length?(A="function"==typeof n?n:u(n),t):A},t.nodeAlign=function(n){return arguments.length?(S="function"==typeof n?n:u(n),t):S},t.nodeWidth=function(n){return arguments.length?(M=+n,t):M},t.nodePadding=function(n){return arguments.length?(C=+n,t):C},t.nodes=function(n){return arguments.length?(z="function"==typeof n?n:u(n),t):z},t.links=function(n){return arguments.length?(T="function"==typeof n?n:u(n),t):T},t.size=function(n){return arguments.length?(w=L=0,b=+n[0],E=+n[1],t):[b-w,E-L]},t.extent=function(n){return arguments.length?(w=+n[0][0],b=+n[1][0],L=+n[0][1],E=+n[1][1],t):[[w,L],[b,E]]},t.iterations=function(n){return arguments.length?(W=+n,t):W},t},t.sankeyCenter=function(t){return t.targetLinks.length?t.depth:t.sourceLinks.length?n.min(t.sourceLinks,o)-1:0},t.sankeyLeft=function(t){return t.depth},t.sankeyRight=function(t,n){return n-1-t.height},t.sankeyJustify=i,t.sankeyLinkHorizontal=function(){return r.linkHorizontal().source(v).target(k)},Object.defineProperty(t,"__esModule",{value:!0})}),function(t,n){if("function"==typeof define&&define.amd)define(["d3"],n);else if("object"==typeof module&&module.exports){var e=require("d3");module.exports=n(e)}else t.d3.tip=n(t.d3)}(this,function(t){return function(){function n(t){c=r(t),f=c.createSVGPoint(),document.body.appendChild(d)}function e(){var n=t.select(document.createElement("div"));return n.style("position","absolute").style("top",0).style("opacity",0).style("pointer-events","none").style("box-sizing","border-box"),n.node()}function r(t){return"svg"===(t=t.node()).tagName.toLowerCase()?t:t.ownerSVGElement}function o(){return null===d&&(d=e(),document.body.appendChild(d)),t.select(d)}function i(){for(var n=h||t.event.target;void 0===n.getScreenCTM&&"undefined"===n.parentNode;)n=n.parentNode;var e={},r=n.getScreenCTM(),o=n.getBBox(),i=o.width,u=o.height,a=o.x,s=o.y;return f.x=a,f.y=s,e.nw=f.matrixTransform(r),f.x+=i,e.ne=f.matrixTransform(r),f.y+=u,e.se=f.matrixTransform(r),f.x-=i,e.sw=f.matrixTransform(r),f.y-=u/2,e.w=f.matrixTransform(r),f.x+=i,e.e=f.matrixTransform(r),f.x-=i/2,f.y-=u/2,e.n=f.matrixTransform(r),f.y+=u,e.s=f.matrixTransform(r),e}function u(t){return"function"==typeof t?t:function(){return t}}var a=function(){return"n"},s=function(){return[0,0]},l=function(){return" "},d=e(),c=null,f=null,h=null;n.show=function(){var t=Array.prototype.slice.call(arguments);t[t.length-1]instanceof SVGElement&&(h=t.pop());var e,r=l.apply(this,t),i=s.apply(this,t),u=a.apply(this,t),d=o(),c=g.length,f=document.documentElement.scrollTop||document.body.scrollTop,y=document.documentElement.scrollLeft||document.body.scrollLeft;for(d.html(r).style("opacity",1).style("pointer-events","all");c--;)d.classed(g[c],!1);return e=p.get(u).apply(this),d.classed(u,!0).style("top",e.top+i[0]+f+"px").style("left",e.left+i[1]+y+"px"),n},n.hide=function(){return o().style("opacity",0).style("pointer-events","none"),n},n.attr=function(e,r){if(arguments.length<2&&"string"==typeof e)return o().attr(e);var i=Array.prototype.slice.call(arguments);return t.selection.prototype.attr.apply(o(),i),n},n.style=function(e,r){if(arguments.length<2&&"string"==typeof e)return o().style(e);var i=Array.prototype.slice.call(arguments);return t.selection.prototype.style.apply(o(),i),n},n.direction=function(t){return arguments.length?(a=null==t?t:u(t),n):a},n.offset=function(t){return arguments.length?(s=null==t?t:u(t),n):s},n.html=function(t){return arguments.length?(l=null==t?t:u(t),n):l},n.destroy=function(){return d&&(o().remove(),d=null),n};var p=t.map({n:function(){var t=i();return{top:t.n.y-d.offsetHeight,left:t.n.x-d.offsetWidth/2}},s:function(){var t=i();return{top:t.s.y,left:t.s.x-d.offsetWidth/2}},e:function(){var t=i();return{top:t.e.y-d.offsetHeight/2,left:t.e.x}},w:function(){var t=i();return{top:t.w.y-d.offsetHeight/2,left:t.w.x-d.offsetWidth}},nw:function(){var t=i();return{top:t.nw.y-d.offsetHeight,left:t.nw.x-d.offsetWidth}},ne:function(){var t=i();return{top:t.ne.y-d.offsetHeight,left:t.ne.x}},sw:function(){var t=i();return{top:t.sw.y,left:t.sw.x-d.offsetWidth}},se:function(){var t=i();return{top:t.se.y,left:t.e.x}}}),g=p.keys();return n}}),t.createSankey=function(t,n,e,r){function o(t){return n.links.formatValue?n.links.formatValue(t):t+" "+n.links.unit}var i=function(t){return Math.max(t,Number.MIN_VALUE)},u={nodes:[],links:[]};e.nodes.map(function(t){u.nodes.push({name:t.name,color:t.color,id:t.id})}),e.links.map(function(t){u.links.push({source:t.source,target:t.target,id:t.id,color:t.color,defaultColor:t.defaultColor,highlightColor:t.highlightColor,value:i(t.value),over:t.over})});!function(t){for(var n=0;n<t.length;n++)void 0==t[n].id&&(t[n].id=t[n].source+" -> "+t[n].target)}(u.links),d3.select(".d3-tip-nodes").remove(),d3.select(".d3-tip").remove(),d3.select(t+" svg").remove();var a,s=d3.select(t),l=function(t,n){var e=t.node().getBoundingClientRect();return{width:e.width-n.left-n.right,height:e.height-n.top-n.bottom}}(s,n.margin),d=s.append("svg").attr("width",l.width+n.margin.left+n.margin.right).attr("height",l.height+n.margin.top+n.margin.bottom).attr("class","sk-svg").append("g").attr("transform","translate("+n.margin.left+","+n.margin.top+")"),c=d3.sankey().nodeWidth(11).nodePadding(5).extent([[0,20],[l.width,l.height]]),f=d3.sankeyLinkHorizontal(),h=function(t){return n.nodes.fontSize},p=function(t){};n.nodes.dynamicSizeFontNode.enabled&&(a=d3.scaleLinear().range([n.nodes.dynamicSizeFontNode.minSize,n.nodes.dynamicSizeFontNode.maxSize]),p=function(t){a.domain(d3.extent(t,function(t){return t.value}))},h=function(t){return Math.floor(a(t.value))});var g=!1,y=!0;void 0!=n.nodes.draggableX&&(g=n.nodes.draggableX),void 0!=n.nodes.draggableY&&(y=n.nodes.draggableY);for(var m=0;m<u.nodes.length;m++)void 0==u.nodes[m].color&&(u.nodes[m].color=n.nodes.colors(u.nodes[m].name.replace(/ .*/,"")));var v=d3.tip().attr("class","d3-tip").offset([-10,0]),k=d3.tip().attr("class","d3-tip d3-tip-nodes").offset([-10,0]);v.html(function(t){var n,e;return u.links.indexOf(t.source.name)>-1?(e=t.source.name,n=t.target.name):(e=t.target.name,n=t.source.name),'<div class="table-wrapper"><center><h1>'+n+'</h1></center><table><tr><td class="col-left">'+e+'</td><td align="right">'+o(t.value)+"</td></tr></table></div>"});var x=d3.select(".sk-svg").node().getBoundingClientRect().top;v.move=function(t){v.style("top",function(){return d3.event.pageY-x-65>=0?d3.event.pageY-65+"px":d3.event.pageY+20+"px"}).style("left",function(){var t=Math.max(d3.event.pageX-65,10);return(t=Math.min(t,window.innerWidth-d3.select(".d3-tip").node().getBoundingClientRect().width-20))+"px"})},k.html(function(t){var e,r=t.name,i=t.targetLinks,u=t.sourceLinks;for(e='<div class="table-wrapper"><center><h1>'+r+"</h1></center><table>",i.length>0&u.length>0&&(e+="<tr><td><h2>"+n.tooltip.labelSource+"</h2></td><td></td></tr>"),m=0;m<i.length;++m)e+='<tr><td class="col-left">'+i[m].source.name+'</td><td align="right">'+o(i[m].value)+"</td></tr>";for(i.length>0&u.length>0&&(e+="<tr><td></td><td></td><tr><td></td><td></td> </tr><tr><td><h2>"+n.tooltip.labelTarget+"</h2></td><td></td></tr>"),m=0;m<u.length;++m)e+='<tr><td class="col-left">'+u[m].target.name+'</td><td align="right">'+o(u[m].value)+"</td></tr>";return e+="</table></div>"}),k.move=function(t){k.boxInfo=d3.select(".d3-tip-nodes").node().getBoundingClientRect(),k.style("top",function(){return d3.event.pageY-x-k.boxInfo.height-20>=0?d3.event.pageY-k.boxInfo.height-20+"px":d3.event.pageY+20+"px"}).style("left",function(){var t=Math.max(d3.event.pageX-130,10);return(t=Math.min(t,window.innerWidth-d3.select(".d3-tip").node().getBoundingClientRect().width-20))+"px"})};var w=function(){v&&v.hide(),k&&k.hide()};c(u),p(u.nodes);var L=d.append("g").selectAll(".sk-link").data(u.links,function(t){return t.id}).enter().append("path").attr("class","sk-link").attr("d",f).style("stroke",function(t){return t.color}).style("stroke-width",function(t){return Math.max(1,t.width)+"px"}).on("mouseover",function(t){t.over=!0,r(t.id),t.color=t.source.color,d3.selectAll(".sk-link").style("stroke",function(t){return t.color}),c(u),c.update(u)}).on("mouseout",function(t){t.over=!1,r(null),t.color=t.defaultColor,d3.selectAll(".sk-link").style("stroke",function(t){return t.color}),c(u),c.update(u),c(u),c.update(u)}).sort(function(t,n){return n.width-t.width}),b=d.append("g").selectAll(".sk-node").data(u.nodes,function(t){return t.name}).enter().append("g").attr("class","sk-node").attr("transform",function(t){return"translate("+t.x0+","+t.y0+")"}).on("mouseover",function(t){r(JSON.stringify(t.id));var n;for(n=0;n<t.sourceLinks.length;n++)t.sourceLinks[n].color=t.color;for(n=0;n<t.targetLinks.length;n++)t.targetLinks[n].color=t.color;d3.selectAll(".sk-link").style("stroke",function(t){return t.color}),c(u),c.update(u)}).on("mouseout",function(t){r(null);var n;for(n=0;n<t.sourceLinks.length;n++)t.sourceLinks[n].color=t.sourceLinks[n].defaultColor;for(n=0;n<t.targetLinks.length;n++)t.targetLinks[n].color=t.targetLinks[n].defaultColor;d3.selectAll(".sk-link").style("stroke",function(t){return t.color}),c(u),c.update(u)});(g||y)&&b.call(d3.drag().subject(function(t){return t}).on("start",function(t){d3.event.sourceEvent.stopPropagation(),this.parentNode.appendChild(this)}).on("drag",function(t){if(w(),g&&d3.event.x<l.width&&(t.x0=Math.max(0,Math.min(l.width-c.nodeWidth(),t.x0+d3.event.dx)),t.x1=t.x0+c.nodeWidth()),y&&d3.event.y<l.height){var n=t.y1-t.y0;t.y0=Math.max(0,Math.min(l.height-(t.y1-t.y0),t.y0+d3.event.dy)),t.y1=t.y0+n}d3.select(this).attr("transform","translate("+t.x0+","+t.y0+")"),c.update(u),L.attr("d",f)})),b.append("rect").attr("height",function(t){return t.y1-t.y0}).attr("width",c.nodeWidth()).style("fill",function(t){return t.color}).style("stroke",function(t){return d3.rgb(t.color).darker(1.8)}),b.append("text").attr("x",-6).attr("y",function(t){return(t.y1-t.y0)/2}).attr("dy",".35em").attr("text-anchor","end").attr("transform",null).style("fill",function(t){return d3.rgb(t.color).darker(2.4)}).text(function(t){return t.name}).style("font-size",function(t){return h(t)+"px"}).filter(function(t){return t.x0<l.width/2}).attr("x",6+c.nodeWidth()).attr("text-anchor","start");var E=function(t){w(),c(t),c.update(t),p(t.nodes),d.selectAll(".sk-link").data(t.links,function(t){return t.id}).sort(function(t,n){return n.width-t.width}).transition().duration(1300).attr("d",f).style("stroke-width",function(t){return Math.max(1,t.width)+"px"}),d.selectAll(".sk-node").data(t.nodes,function(t){return t.name}).transition().duration(1300).attr("transform",function(t){return"translate("+t.x0+","+t.y0+")"}),d.selectAll(".sk-node rect").transition().duration(1300).attr("height",function(t){return t.y1-t.y0}),d.selectAll(".sk-node text").transition().duration(1300).attr("y",function(t){return(t.y1-t.y0)/2}).style("font-size",function(t){return h(t)+"px"})};return this.updateData=function(t){for(var n=0;n<t.links.length;n++){var e=t.links[n].id||t.links[n].source+" -> "+t.links[n].target,r=u.links.filter(function(t){return t.id==e})[0];r&&(r.value=i(t.links[n].value))}E(u)},n.titles.forEach(function(t,n,e){d.append("text").attr("x",n*(l.width/e.length)+t[1]).attr("y",0).attr("transform","translate(0, 0)").text(function(n){return t[0]})}),this},t.version="0.2.0"}();
//# sourceMappingURL=sk.d3.min.js.map